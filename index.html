<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Video Analysis Dashboard</title>
    <link rel="stylesheet" href="styles.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>
<body>
    <div class="container">
        <!-- Live Video Feed Section -->
        <div class="camera-container">
            <iframe src="http://192.168.1.13:8080" frameborder="0" width="100%" height="100%"></iframe>
            <div class="overlay">CAMERA 1 - LIVE FEED</div>
        </div>

        <!-- Input Forms -->
        <div class="form-container">
            <!-- Video Path Form -->
            <h2>Submit Video Path</h2>
            <input type="text" id="videoPath" placeholder="Enter RTSP or HTTP Video Path">
            <button onclick="submitVideoPath()">Submit Video Path</button>

            <!-- Describe Image Form -->
            <h2>Describe Image</h2>
            <input type="file" id="imageInput" accept="image/*">
            <button onclick="submitImage()">Submit Image</button>
            
            <!-- Insert Person Form -->
            <h2>Insert Person</h2>
            <input type="text" id="personName" placeholder="Enter Person Name">
            <input type="file" id="personImage" accept="image/*">
            <button onclick="insertPerson()">Insert Person</button>

            <!-- Perform Face Recognition Form -->
            <h2>Perform Face Recognition</h2>
            <input type="text" id="recognitionName" placeholder="Enter Name for Recognition">
            <button onclick="performFaceRecognition()">Perform Face Recognition</button>
        </div>
    </div>

    <!-- Matched People Statistics Section -->
    <h1>Matched People Statistics</h1>
    <canvas id="ageChart" width="400" height="200"></canvas>
    <canvas id="genderChart" width="400" height="200"></canvas>
    <canvas id="raceChart" width="400" height="200"></canvas>
    <canvas id="emotionChart" width="400" height="200"></canvas>

    <script>
        // Fetch data from the FastAPI endpoint
        async function fetchMatchedPeopleData() {
            const response = await fetch('http://127.0.0.1:8000/get_matched_people/');
            const data = await response.json();
            return data.matched_people;
        }

        // Process and visualize the data
        async function displayCharts() {
            const matchedPeople = await fetchMatchedPeopleData();

            // Extract data for the charts
            const ages = matchedPeople.map(person => person.age);
            const genders = matchedPeople.map(person => person.gender);
            const races = matchedPeople.map(person => person.race);
            const emotions = matchedPeople.map(person => person.emotion);

            // Age Chart
            new Chart(document.getElementById('ageChart'), {
                type: 'bar',
                data: {
                    labels: ages,
                    datasets: [{
                        label: 'Age Distribution',
                        data: ages,
                        backgroundColor: 'rgba(75, 192, 192, 0.2)',
                        borderColor: 'rgba(75, 192, 192, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });

            // Gender Chart
            const genderCounts = genders.reduce((acc, gender) => {
                acc[gender] = (acc[gender] || 0) + 1;
                return acc;
            }, {});
            new Chart(document.getElementById('genderChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(genderCounts),
                    datasets: [{
                        label: 'Gender Distribution',
                        data: Object.values(genderCounts),
                        backgroundColor: ['rgba(255, 99, 132, 0.2)', 'rgba(54, 162, 235, 0.2)'],
                        borderColor: ['rgba(255, 99, 132, 1)', 'rgba(54, 162, 235, 1)'],
                        borderWidth: 1
                    }]
                }
            });

            // Race Chart
            const raceCounts = races.reduce((acc, race) => {
                acc[race] = (acc[race] || 0) + 1;
                return acc;
            }, {});
            new Chart(document.getElementById('raceChart'), {
                type: 'pie',
                data: {
                    labels: Object.keys(raceCounts),
                    datasets: [{
                        label: 'Race Distribution',
                        data: Object.values(raceCounts),
                        backgroundColor: [
                            'rgba(255, 206, 86, 0.2)',
                            'rgba(75, 192, 192, 0.2)',
                            'rgba(153, 102, 255, 0.2)'
                        ],
                        borderColor: [
                            'rgba(255, 206, 86, 1)',
                            'rgba(75, 192, 192, 1)',
                            'rgba(153, 102, 255, 1)'
                        ],
                        borderWidth: 1
                    }]
                }
            });

            // Emotion Chart
            const emotionCounts = emotions.reduce((acc, emotion) => {
                acc[emotion] = (acc[emotion] || 0) + 1;
                return acc;
            }, {});
            new Chart(document.getElementById('emotionChart'), {
                type: 'bar',
                data: {
                    labels: Object.keys(emotionCounts),
                    datasets: [{
                        label: 'Emotion Distribution',
                        data: Object.values(emotionCounts),
                        backgroundColor: 'rgba(153, 102, 255, 0.2)',
                        borderColor: 'rgba(153, 102, 255, 1)',
                        borderWidth: 1
                    }]
                },
                options: {
                    scales: {
                        y: { beginAtZero: true }
                    }
                }
            });
        }

        // Display the charts on page load
        displayCharts();
    </script>

    <script src="scripts.js"></script>
</body>
</html>
